<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>RR Admin Login</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:system-ui;
  background:#0f172a;
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
.card{
  width:320px;
  background:#020617;
  padding:24px;
  border-radius:18px;
  box-shadow:0 0 30px rgba(0,0,0,.8);
  text-align:center;
}
.logo{
  width:90px;
  margin-bottom:14px;
}
h2{margin:10px 0}
input{
  width:100%;
  padding:14px;
  border-radius:12px;
  border:none;
  outline:none;
  margin-top:14px;
  background:#020617;
  color:#fff;
  border:1px solid #334155;
}
button{
  width:100%;
  padding:14px;
  margin-top:18px;
  border:none;
  border-radius:12px;
  background:linear-gradient(135deg,#ff9800,#ff5722);
  color:#fff;
  font-weight:700;
  font-size:16px;
}
.msg{
  margin-top:14px;
  font-size:14px;
  color:#f87171;
}
</style>
</head>

<body>

<div class="card">
  <img src="vishnu.png" class="logo">
  <h2>RR Admin Panel</h2>
  <p>Enter License Key</p>

  <input id="key" placeholder="RR-ADMIN-001">
  <button onclick="login()">LOGIN</button>
  <div class="msg" id="msg"></div>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "PASTE_YOUR_API_KEY",
  authDomain: "PASTE.firebaseapp.com",
  projectId: "RR-Admin-System"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const deviceId = localStorage.getItem("deviceId") ||
  crypto.randomUUID();
localStorage.setItem("deviceId", deviceId);

function login(){
  const key = document.getElementById("key").value.trim();
  const msg = document.getElementById("msg");

  if(!key){ msg.innerText="Enter license key"; return; }

  db.collection("licenses").doc(key).get().then(doc=>{
    if(!doc.exists){
      msg.innerText="Invalid key";
      return;
    }

    const d = doc.data();
    const today = new Date().toISOString().split("T")[0];

    if(!d.active){
      msg.innerText="License disabled";
      return;
    }

    if(d.expiry < today){
      msg.innerText="License expired";
      return;
    }

    if(d.deviceId && d.deviceId !== deviceId){
      msg.innerText="Key already used on another device";
      return;
    }

    // Bind device
    if(!d.deviceId){
      db.collection("licenses").doc(key).update({
        deviceId: deviceId
      });
    }

    // SUCCESS
    window.location.href = "panel.html";
  });
}
</script>

</body>
</html>